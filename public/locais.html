<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Localização-Turma B</title>
<link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: #f4f6f8;
    margin: 0;
    padding: 0;
}
.main-container { max-width: 1200px; margin: 20px auto; padding: 10px; }
h2 { text-align: center; color: #00737a; margin-bottom: 20px; font-weight: 600; }
#locaisContainer { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }
.local-container { background: #ffffff; border-radius: 10px; padding: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
.local-container h3 { color: #c0305e; font-weight: 600; margin-bottom: 10px; text-align: center; }
table { width: 100%; border-collapse: collapse; table-layout: fixed; font-size: 0.85rem; }
th, td { text-align: center; padding: 6px 8px; vertical-align: middle; overflow: visible !important;  text-overflow: unset !important; white-space: normal !important; }
th { background-color: #00737a; color: #fff; font-weight: 500; }
tbody tr:nth-child(even) { background-color: #e6f6f5; }
tbody tr:hover { background-color: #c0ece8; transition: 0.3s; }
td.status { font-size: 1rem; }
td.nome { color: #00737a; font-weight: 500; }
@media (max-width: 992px) { #locaisContainer { grid-template-columns: repeat(2, 1fr); } }
@media (max-width: 576px) { #locaisContainer { grid-template-columns: 1fr; } table, th, td { font-size: 0.75rem; padding: 4px; } h2 { font-size: 18px; } }
</style>
</head>
<body>
<div class="main-container">
    <h2>Localização - Turma B</h2>
    <div id="locaisContainer"></div>
</div>

<script>
const LOCALS = ['OFC/OEM','Pial','Carga Geral'];

// Apenas para exibição
const LOCAL_DISPLAY_NAMES = {
    'OFC/OEM': 'Oficina/ OEM',
    'Pial': 'Pial',
    'Carga Geral': 'Carga Geral'
};

async function carregarPessoasPorLocal() {
    try {
        const res = await fetch('/pessoas', { credentials: 'include' });
        if (!res.ok) return;
        const data = await res.json();
        const pessoas = data.pessoas;

        const container = document.getElementById('locaisContainer');
        container.innerHTML = '';

        LOCALS.forEach(local => {
            const pessoasDoLocal = pessoas
                .filter(p => p.local === local)
                .sort((a,b) => a.nome.localeCompare(b.nome, 'pt-BR', {sensitivity:'base'}));

            const localDiv = document.createElement('div');
            localDiv.classList.add('local-container');

            // Mostrar o nome customizado do local
            const displayName = LOCAL_DISPLAY_NAMES[local] || local;

            localDiv.innerHTML = `
                <h3>${displayName}</h3>
                <div class="table-responsive">
                    <table class="table table-bordered align-middle">
                        <thead>
                            <tr>
                                <th>Status</th>
                                <th>Nome</th>
                                <th>Início</th>
                                <th>Fim</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${pessoasDoLocal.length > 0
                                ? pessoasDoLocal.map(p => `
                                    <tr>
                                        <td class="status">${p.status||''}</td>
                                        <td class="nome">${p.nome||''}</td>
                                        <td>${p.hora_inicial||''}</td>
                                        <td>${p.hora_final||''}</td>
                                    </tr>
                                `).join('')
                                : `<tr><td colspan="4">Nenhuma pessoa no momento</td></tr>`
                            }
                        </tbody>
                    </table>
                </div>
            `;
            container.appendChild(localDiv);
        });
    } catch(e) {
        console.error('Erro ao carregar pessoas por local:', e);
    }
}

window.addEventListener('load', () => {
    carregarPessoasPorLocal();
    setInterval(carregarPessoasPorLocal, 2000);
});
</script>
</body>
</html>
